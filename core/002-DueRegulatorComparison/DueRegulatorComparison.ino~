#include <SPI.h>
#include <DueTimer.h>

#include "Generator.h"
#include "VoltConvert.h"

#define MOSI 11
#define SCK  13
#define LD0   8
#define CS0   9
#define CLR  10

Generator G1 = Generator(3.3f, DAC_INTERN, DAC0, A8);
Generator G1 = Generator(5.0f, DAC_EXTERN, CS0,  A8, LD0);
float dt = 0.01;

void setup() {
  
  //G1 = Generator(A0, DAC0);
  G1.init();
  
  Timer3.attachInterrupt(generator_step);
  Timer3.start(dt*1000000);
  Timer4.attachInterrupt(voltmeter_step);
  Timer4.start(250000);

  for (int i = 0; i < NUM_DIGITS; i++) {
    pinMode(FIRST_DIGIT + i, OUTPUT);
    digitalWrite(FIRST_DIGIT + i, HIGH);
  }
  
  analogReadResolution(12); 
  analogWriteResolution(12);
  
  //analogWrite(DAC0, level(1.5f));
  G1.output();
}

void generator_step() {
  G1.iterate(dt);
  //G1.output();
}

void loop() {

}
